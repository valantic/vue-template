<template>
  <l-default>
    <div :class="b()">
      <c-notification-container display-type="field" />
      <e-label :state="errors['first-name'].state" name="First name:" position="top">
        <e-input
          v-model="form.firstName"
          :state="errors['first-name'].state"
          :notification="errors['first-name'].notification"
          name="first-name"
          placeholder="First name"
        />
      </e-label>
      <e-label :state="errors['last-name'].state" name="Last name:" position="top">
        <e-input
          v-model="form.lastName"
          :state="errors['last-name'].state"
          :notification="errors['last-name'].notification"
          name="last-name"
          placeholder="Last name"
        />
      </e-label>
      <e-label :state="errors.email.state" name="Email:" position="top">
        <e-input
          v-model="form.email"
          :state="errors.email.state"
          :notification="errors.email.notification"
          name="email"
          placeholder="email"
        />
      </e-label>

      <e-button @click="addGlobalSuccess">
        Success
      </e-button>
      <e-button @click="addGlobalWarning">
        Warning
      </e-button>
      <e-button @click="addGlobalError">
        Error
      </e-button>
      <e-button @click="addGlobalInfo">
        Info
      </e-button>
      <e-button @click="addConfirmation">
        Confirmation
      </e-button>
      <e-button @click="addFieldError">
        Field Error
      </e-button>

      <div :class="b('selector')">
        <c-notification-container display-type="selector" selector="1" />
        <e-button style="margin-top: 10px; margin-right: 10px;" @click="addSelectorInfo1">
          Selector Info (1)
        </e-button>
      </div>
    </div>
  </l-default>
</template>

<script lang="ts">
  import { defineComponent } from 'vue';
  import api from '@/helpers/api';
  import lDefault from '@/components/l-default.vue';
  import cNotificationContainer from '@/components/c-notification-container.vue';
  import notificationData from '@/styleguide/mock-data/api-response/notifications';
  import { INotification } from '@/types/c-notification';
  import store from '@/store';

  interface IError {
    state: string;
    notification: string;
  }

  interface IErrors {
    'first-name': IError;
    'last-name': IError;
    email: IError;
  }

  interface IData {
    form: {
      firstName: string;
      lastName: string;
      email: string;
    };
    errors: IErrors
  }

  export default defineComponent({
    name: 'notifications',
    components: {
      lDefault,
      cNotificationContainer,
    },
    data(): IData {
      return {
        form: {
          firstName: '',
          lastName: '',
          email: '',
        },
        errors: {
          'first-name': {
            state: 'default',
            notification: '',
          },
          'last-name': {
            state: 'default',
            notification: '',
          },
          'email': {
            state: 'default',
            notification: '',
          },
        },
      };
    },
    computed: {
      /**
       * Returns an Array of field notifications.
       */
      getFieldNotifications(): readonly INotification[] {
        return store.getters.notification.getFieldNotifications;
      }
    },
    mounted() {
      notificationData.list.forEach(notification => store.commit.notification.pushNotification(notification));
    },
    methods: {
      /**
       * Event handler for global success message button.
       */
      addGlobalSuccess() {
        api.post('/notifications/global/success', {}, { }, { title: 'Some title', expire: true } as INotification);
      },

      /**
       * Event handler for global warning message button.
       */
      addGlobalWarning() {
        api.post('/notifications/global/warning', {}, { }, { title: 'Some title', expire: true } as INotification);
      },

      /**
       * Event handler for global error message button.
       */
      addGlobalError() {
        api.post('/notifications/global/error', {}, { }, { title: 'Some title', expire: true } as INotification);
      },

      /**
       * Event handler for global info message button.
       */
      addGlobalInfo() {
        api.post('/notifications/global/info', {}, { }, { title: 'Some title', expire: true } as INotification);
      },

      /**
       * Event handler for add confirmation button.
       */
      addConfirmation() {
        notificationData.confirmationMessage.messages.forEach((message) => {
          store.commit.notification.pushNotification({
            message,
          });
        });
      },

      /**
       * Event handler for add field error button.
       */
      addFieldError() {
        store.commit.notification.flushFieldNotifications();

        api.post('/notifications/field/error')
          .then((response) => {
            for (let i = 0; i < this.getFieldNotifications.length; i += 1) {
              const notification = this.getFieldNotifications[i] as INotification;
              const error = notification.message?.source?.field as keyof IErrors;

              if (notification.message?.source) {
                this.errors[error].state = notification.message.type;
                this.errors[error].notification = notification.message.message;
              }
            }

            return Promise.resolve(response);
          });
      },

      /**
       * Event handler for add selector info button.
       */
      addSelectorInfo1() {
        api.post('/notifications/selector/info1', {}, { }, { expire: true });
      },
    },
  });
</script>

<style lang="scss">
  .notifications {
    padding: $spacing--50;

    @include media(sm) {
      margin-left: 400px;
    }

    .e-label,
    .e-button {
      margin-bottom: $spacing--10;
      margin-right: $spacing--10;
    }

    &__selector {
      margin-bottom: $spacing--10;
    }
  }
</style>
