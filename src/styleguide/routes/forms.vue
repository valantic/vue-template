<template>
  <div :class="b()">
    <!-- Rendered form -->
    <section :class="b('form')">
      <h1>
        Newsletter Registration
      </h1>
      <form ref="form"
            action="#form-url"
            method="POST"
            @submit.prevent="onSubmit"
      >
        <!-- Section 1 -->
        <e-fieldset legend="Contact information">
          <e-label name="Name">
            <e-input v-model="form.name"
                     name="name"
                     placeholder="Your Name"
            />
          </e-label>
          <e-label name="E-Mail" required>
            <e-input v-model="form.email"
                     :state="$v.form.email.$error ? 'error' : 'default'"
                     :notification="$v.form.email.$error ? 'No valid email address' : ''"
                     type="email"
                     name="email"
                     placeholder="Your E-Mail"
                     @blur="$v.form.email.$touch()"
            />
          </e-label>
          <e-label name="Language" required>
            <e-select v-model="form.language"
                      :options="mock.languages"
                      :state="$v.form.language.$error ? 'error' : 'default'"
                      :notification="$v.form.language.$error ? 'Required field' : ''"
                      name="language"
                      @blur="$v.form.language.$touch()"
            />
          </e-label>
          <e-label name="Notes">
            <e-textarea v-model="form.notes"
                        name="notes"
                        placeholder="Your Notes"
            />
          </e-label>
        </e-fieldset>

        <!-- Section 2 -->
        <e-fieldset legend="Personal interests">
          <e-label name="Topics" tag="div">
            <e-checkbox v-model="form.topics"
                        value="food"
                        name="topics">
              Food
            </e-checkbox>
            <e-checkbox v-model="form.topics"
                        value="technics"
                        name="topics">
              Technics
            </e-checkbox>
            <e-checkbox v-model="form.topics"
                        value="celebrities"
                        name="topics">
              Celebrities
            </e-checkbox>
            <e-checkbox v-model="form.topics"
                        value="garden"
                        name="topics">
              Garden
            </e-checkbox>
            <e-checkbox v-model="form.topics"
                        value="architecture"
                        name="topics">
              Architecture
            </e-checkbox>
          </e-label>

          <e-label name="Frequency of Mailing" tag="div">
            <e-radio v-model="form.frequency"
                     value="onceAWeek"
                     name="frequency">
              Once a week
            </e-radio>
            <e-radio v-model="form.frequency"
                     value="twiceAWeek"
                     name="frequency">
              Twice a week
            </e-radio>
            <e-radio v-model="form.frequency"
                     value="onceAMonth"
                     name="frequency">
              Once a month
            </e-radio>
            <e-radio v-model="form.frequency"
                     value="twiceAMonth"
                     name="frequency">
              Twice a month
            </e-radio>
          </e-label>
        </e-fieldset>

        <e-button type="submit" primary>
          Submit
        </e-button>
      </form>
    </section>

    <!-- Data object -->
    <section :class="b('data')">
      <h1>Data:</h1>
      <small>
        <pre>{{ form }}</pre>
      </small>
    </section>

    <!-- Vuelidate object -->
    <section :class="b('validation')">
      <h1>Validation:</h1>
      <small>
        <pre>{{ $v.form }}</pre>
      </small>
    </section>
  </div>
</template>
<script lang="ts">
  import { defineComponent } from 'vue';
  import eFieldset from '@/components/e-fieldset';
  import { required, email } from 'vuelidate/lib/validators';

  interface ISelectItem {
    label: string;
    value: string;
  }

  interface IMealItem {
    value: string;
    id: string;
  }

  interface IData {
    demo: {
      firstName: string;
      message: string;
      meal: (string | number)[];
      drink: string;
      language: string;
    },
    mock: {
      selects: ISelectItem[];
      mealValues: IMealItem[];
    }
  }

  export default defineComponent({
    name: 'forms',
    components: {
      eFieldset
    },
    data(): IData {
      return {
        form: {
          name: '',
          email: '',
          notes: '',
          language: '',
          topics: [],
          frequency: '',
        },
        mock: {
          languages: [
            {
              label: 'German',
              value: 'german',
            },
            {
              label: 'Italian',
              value: 'italian',
            },
            {
              label: 'French',
              value: 'french',
            }
          ],
          mealValues: [
            'pizza',
            'spaghetti',
            'lasagne',
          ].map(item => ({
            id: item,
            value: item
          }))
        }
      };
    },

    /**
     * Vueldate validation config.
     */
    validations: {
      form: {
        email: {
          required,
          email,
        },
        language: {
          required,
        },
      }
    },

    methods: {
      /**
       * Submit form event handler.
       */
      onSubmit() {
        this.$v.$touch();

        if (this.$v.$pending || this.$v.$error) {
          return;
        }

        const { form } = this.$refs;

        if (form) {
          form.submit();
        }
      },
    }
  };
</script>

<style lang="scss">
  .forms {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;

    &__form,
    &__data,
    &__validation {
      padding: $spacing--50;
      border: 1px dotted $color-grayscale--500;
    }

    .e-fieldset {
      margin-bottom: $spacing--50;
    }

    .e-label:not(:last-of-type) {
      margin-bottom: $spacing--10;
    }
  }
</style>
